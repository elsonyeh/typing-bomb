// ui.c - ç”¨æˆ¶ç•Œé¢ç›¸é—œå‡½æ•¸ï¼ˆç²¾ç°¡ç‰ˆï¼Œåªä¿ç•™å¿…è¦åŠŸèƒ½ï¼‰
#include "ui.h"
#include "game.h"
#include "scoreboard.h"

// ========== åŸºç¤UIåŠŸèƒ½ ==========

// æ¸…å±
void clearScreen()
{
    system("cls");
}

// è¨­ç½®æ§åˆ¶å°é¡è‰²
void setColor(int color)
{
    SetConsoleTextAttribute(hConsole, color);
}

// è¨­ç½®å…‰æ¨™ä½ç½®
void gotoxy(int x, int y)
{
    COORD pos = {x, y};
    SetConsoleCursorPosition(hConsole, pos);
}

// åˆå§‹åŒ–æ§åˆ¶å°
void initConsole()
{
    // ç²å–æ§åˆ¶å°å¥æŸ„
    hConsole = GetStdHandle(STD_OUTPUT_HANDLE);

    // è¨­ç½®æ§åˆ¶å°ç·¨ç¢¼ç‚º UTF-8
    SetConsoleOutputCP(65001);
    SetConsoleCP(65001);

    // è¨­ç½®æ§åˆ¶å°æ¨™é¡Œ
    SetConsoleTitleA("Typing Bomb Game");

    // è¨­ç½®æ§åˆ¶å°å­—é«”ï¼ˆæ”¯æŒä¸­æ–‡å’Œè¡¨æƒ…ç¬¦è™Ÿï¼‰
    CONSOLE_FONT_INFOEX cfi;
    cfi.cbSize = sizeof(cfi);
    cfi.nFont = 0;
    cfi.dwFontSize.X = 0;
    cfi.dwFontSize.Y = 16;
    cfi.FontFamily = FF_DONTCARE;
    cfi.FontWeight = FW_NORMAL;
    wcscpy(cfi.FaceName, L"NSimSun"); // ä½¿ç”¨æ–°å®‹é«”ï¼Œå¥½æ”¯æŒä¸­æ–‡
    SetCurrentConsoleFontEx(hConsole, FALSE, &cfi);

    // æ¸…å±
    clearScreen();
}

// ========== é¸å–®ç•Œé¢åŠŸèƒ½ ==========

// ä¸»é¸å–®
void showMainMenu()
{
    clearScreen();
    setColor(COLOR_TITLE);
    printf("\n");
    printf("    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("    â•‘            æ‰“å­—ç‚¸å½ˆ Typing Bomb              â•‘\n");
    printf("    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

    setColor(COLOR_DEFAULT);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                1. é–‹å§‹éŠæˆ²                   â”‚\n");
    printf("    â”‚                2. æŸ¥çœ‹æ’è¡Œæ¦œ                 â”‚\n");
    printf("    â”‚                3. éŠæˆ²èªªæ˜                   â”‚\n");
    printf("    â”‚                4. é€€å‡ºéŠæˆ²                   â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    setColor(COLOR_BLUE);
    printf("    è«‹é¸æ“‡é¸é … (1-4): ");
    setColor(COLOR_DEFAULT);

    int choice;
    scanf("%d", &choice);
    getchar(); // æ¸…é™¤è¼¸å…¥ç·©è¡å€

    switch (choice)
    {
    case 1:
        showModeMenu();
        break;
    case 2:
        showScoreboard();
        break;
    case 3:
        showHelp();
        break;
    case 4:
        exit(0);
    default:
        printf("\n    âŒ ç„¡æ•ˆçš„é¸æ“‡ï¼Œè«‹é‡è©¦\n");
        Sleep(1000);
        showMainMenu();
    }
}

// é¡¯ç¤ºéŠæˆ²æ¨¡å¼é¸å–®
void showModeMenu()
{
    clearScreen();
    setColor(COLOR_TITLE);
    printf("\n");
    printf("    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("    â•‘                 é¸æ“‡éŠæˆ²é›£åº¦                 â•‘\n");
    printf("    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

    setColor(COLOR_GREEN);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                  1. ç°¡å–®æ¨¡å¼                 â”‚\n");
    printf("    â”‚             â€¢ åˆå§‹æ™‚é–“: 7.0 ç§’               â”‚\n");
    printf("    â”‚             â€¢ æœ€çŸ­æ™‚é–“: 3.0 ç§’               â”‚\n");
    printf("    â”‚             â€¢ ç”Ÿå‘½å€¼: 3                      â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    setColor(COLOR_YELLOW);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                  2. ä¸­ç­‰æ¨¡å¼                 â”‚\n");
    printf("    â”‚             â€¢ åˆå§‹æ™‚é–“: 5.0 ç§’               â”‚\n");
    printf("    â”‚             â€¢ æœ€çŸ­æ™‚é–“: 3.0 ç§’               â”‚\n");
    printf("    â”‚             â€¢ ç”Ÿå‘½å€¼: 3                      â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    setColor(COLOR_RED);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                  3. å›°é›£æ¨¡å¼                 â”‚\n");
    printf("    â”‚             â€¢ åˆå§‹æ™‚é–“: 4.0 ç§’               â”‚\n");
    printf("    â”‚             â€¢ æœ€çŸ­æ™‚é–“: 2.0 ç§’               â”‚\n");
    printf("    â”‚             â€¢ ç”Ÿå‘½å€¼: 3                      â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    setColor(COLOR_BLUE);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                 4. è¿”å›ä¸»é¸å–®                â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    setColor(COLOR_DEFAULT);
    printf("    è«‹é¸æ“‡é›£åº¦ (1-4): ");

    int choice;
    scanf("%d", &choice);
    getchar(); // æ¸…é™¤è¼¸å…¥ç·©è¡å€

    switch (choice)
    {
    case 1:
        currentMode = easy;
        break;
    case 2:
        currentMode = medium;
        break;
    case 3:
        currentMode = hard;
        break;
    case 4:
        showMainMenu();
        return;
    default:
        printf("\n    âŒ ç„¡æ•ˆçš„é¸æ“‡ï¼Œè«‹é‡è©¦\n");
        Sleep(1000);
        showModeMenu();
        return;
    }

    // é¡¯ç¤ºç¢ºèªè¨Šæ¯
    setColor(COLOR_BLUE);
    printf("\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚   å·²é¸æ“‡ %s æ¨¡å¼               â”‚\n", currentMode.name);
    printf("    â”‚   æŒ‰ Enter é–‹å§‹éŠæˆ²...           â”‚\n");
    printf("    â”‚   æŒ‰ Esc é‡æ–°é¸æ“‡                â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");
    setColor(COLOR_DEFAULT);

    // ç­‰å¾…ä½¿ç”¨è€…æŒ‰éµ
    while (1)
    {
        int key = getch();
        if (key == 13)
        { // Enter éµ
            selectGameMode();
            break;
        }
        else if (key == 27)
        { // Esc éµ
            showModeMenu();
            break;
        }
    }
}

// éŠæˆ²èªªæ˜
void showHelp()
{
    clearScreen();
    setColor(COLOR_TITLE);
    printf("\n");
    printf("    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("    â•‘                   éŠæˆ²èªªæ˜                   â•‘\n");
    printf("    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

    setColor(COLOR_DEFAULT);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                   éŠæˆ²è¦å‰‡                   â”‚\n");
    printf("    â”‚          â€¢ åœ¨æ™‚é–“å…§è¼¸å…¥é¡¯ç¤ºçš„å–®å­—            â”‚\n");
    printf("    â”‚          â€¢ è¼¸å…¥æ­£ç¢ºå¯ç²å¾—åˆ†æ•¸                â”‚\n");
    printf("    â”‚          â€¢ é€£çºŒæ­£ç¢ºå¯ç²å¾—é€£æ“ŠåŠ æˆ            â”‚\n");
    printf("    â”‚          â€¢ è¼¸å…¥éŒ¯èª¤æˆ–è¶…æ™‚å¤±å»ç”Ÿå‘½            â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                   é“å…·ç³»çµ±                   â”‚\n");
    printf("    â”‚           ğŸ§ª æ²»ç™’è—¥æ°´ - å›å¾©ç”Ÿå‘½             â”‚\n");
    printf("    â”‚           âŒ› æ™‚é–“å»¶é•· - å¢åŠ æ™‚é–“             â”‚\n");
    printf("    â”‚           ğŸ’ é›™å€åˆ†æ•¸ - å¾—åˆ†åŠ å€             â”‚\n");
    printf("    â”‚           ğŸ›¡ï¸ é˜²è­·ç½© - æŠµæ“‹å¤±æ•—               â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                   æ“ä½œèªªæ˜                   â”‚\n");
    printf("    â”‚           â€¢ åªèƒ½è¼¸å…¥å°å¯«å­—æ¯                 â”‚\n");
    printf("    â”‚           â€¢ æŒ‰ Enter ç¢ºèªè¼¸å…¥                â”‚\n");
    printf("    â”‚           â€¢ æŒ‰ Backspace åˆªé™¤å­—ç¬¦            â”‚\n");
    printf("    â”‚           â€¢ é“å…·åªèƒ½åœ¨å›åˆé–‹å§‹å‰ä½¿ç”¨         â”‚\n");
    printf("    â”‚           â€¢ æŒ‰ ESC è¿”å›ä¸»é¸å–®                â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    setColor(COLOR_BLUE);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚             æŒ‰ Enter è¿”å›ä¸»é¸å–®              â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");
    setColor(COLOR_DEFAULT);

    // ä¿®æ”¹æŒ‰éµè™•ç†é‚è¼¯
    int key;
    while ((key = getch()) != 13)
        ; // ç­‰å¾… Enter éµ
    showMainMenu();
}

// éŠæˆ²çµæŸèœå–®
void showGameOver(Player *player)
{
    clearScreen();
    setColor(COLOR_TITLE);
    printf("\n");
    printf("    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("    â•‘                   éŠæˆ²çµæŸ                   â•‘\n");
    printf("    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

    setColor(COLOR_DEFAULT);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                   æœ€çµ‚æˆç¸¾                   â”‚\n");
    printf("    â”‚    å¾—åˆ†ï¼š");
    setColor(COLOR_YELLOW);
    printf("%-30d", player->score);
    setColor(COLOR_DEFAULT);
    printf("      â”‚\n");
    printf("    â”‚    æœ€é«˜é€£æ“Šï¼š");
    setColor(COLOR_GREEN);
    printf("%-26d", player->maxCombo);
    setColor(COLOR_DEFAULT);
    printf("      â”‚\n");
    printf("    â”‚    é›£åº¦ï¼š");
    setColor(COLOR_BLUE);
    printf("%-31s", currentMode.name);
    setColor(COLOR_DEFAULT);
    printf("       â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    setColor(COLOR_BLUE);
    printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("    â”‚                1. å„²å­˜æˆç¸¾                   â”‚\n");
    printf("    â”‚                2. é‡æ–°é–‹å§‹                   â”‚\n");
    printf("    â”‚                3. è¿”å›ä¸»é¸å–®                 â”‚\n");
    printf("    â”‚                4. é€€å‡ºéŠæˆ²                   â”‚\n");
    printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

    setColor(COLOR_DEFAULT);
    printf("    è«‹é¸æ“‡é¸é … (1-4): ");

    int choice;
    while (1)
    {
        if (scanf("%d", &choice) != 1)
        {
            while (getchar() != '\n')
                ; // æ¸…é™¤è¼¸å…¥ç·©è¡å€
            printf("\n    âŒ ç„¡æ•ˆçš„é¸æ“‡ï¼Œè«‹é‡è©¦: ");
            continue;
        }
        getchar(); // æ¸…é™¤è¼¸å…¥ç·©è¡å€

        switch (choice)
        {
        case 1:
            // è¼¸å…¥å§“åä¸¦å„²å­˜æˆç¸¾
            clearScreen();
            setColor(COLOR_GREEN);
            printf("\n");
            printf("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
            printf("    â”‚    è«‹è¼¸å…¥æ‚¨çš„åç¨± (2-12å­—å…ƒ)     â”‚\n");
            printf("    â”‚          ä¸å¯åŒ…å«ç©ºæ ¼            â”‚\n");
            printf("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");

            setColor(COLOR_DEFAULT);
            char tempName[MAX_NAME_LEN];
            while (1)
            {
                printf("    åç¨±ï¼š");
                if (scanf("%19s", tempName) != 1)
                {
                    while (getchar() != '\n')
                        ;
                    printf("    âŒ è¼¸å…¥éŒ¯èª¤ï¼Œè«‹é‡è©¦\n");
                    continue;
                }
                getchar();

                if (strlen(tempName) < 2 || strlen(tempName) > 12)
                {
                    printf("    âŒ åç¨±é•·åº¦å¿…é ˆåœ¨2-12å­—å…ƒä¹‹é–“\n");
                    continue;
                }

                int hasSpace = 0;
                for (int i = 0; tempName[i]; i++)
                {
                    if (isspace(tempName[i]))
                    {
                        hasSpace = 1;
                        break;
                    }
                }
                if (hasSpace)
                {
                    printf("    âŒ åç¨±ä¸å¯åŒ…å«ç©ºæ ¼\n");
                    continue;
                }

                strcpy(player->name, tempName);
                break;
            }

            // å„²å­˜åˆ†æ•¸ä¸¦é¡¯ç¤ºæ’å
            saveScore(player->name, player->score, player->maxCombo, currentMode.name);
            int rank = getPlayerRank(player->name, player->score, currentMode.name);
            printf("    ğŸ† æ‚¨åœ¨%sæ¨¡å¼ä¸­æ’åç¬¬ %d åï¼\n", currentMode.name, rank);
            printf("\n    æŒ‰ä»»æ„éµè¿”å›ä¸»é¸å–®...");
            getch();
            showMainMenu();
            return;

        case 2:
            showModeMenu();
            return;
        case 3:
            showMainMenu();
            return;
        case 4:
            exit(0);
        default:
            printf("\n    âŒ ç„¡æ•ˆçš„é¸æ“‡ï¼Œè«‹é‡è©¦: ");
        }
    }
}